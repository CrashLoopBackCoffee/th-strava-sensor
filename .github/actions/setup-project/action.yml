name: 'Setup Project'
description: 'Sets up Python, UV, project dependencies, and Grafana Alloy for the th-strava-sensor project'
inputs:
  python-version:
    description: 'Python version to install'
    required: false
    default: '3.13'
  alloy-version:
    description: 'Grafana Alloy version to install'
    required: false
    # renovate: datasource=github-releases packageName=grafana/alloy versioning=semver
    default: 'v1.10.0'

runs:
  using: 'composite'
  steps:
    - name: Set up Python ${{ inputs.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: Install uv
      uses: astral-sh/setup-uv@v6

    - name: Install dependencies
      shell: bash
      run: |
        python -m pip install --upgrade pip poetry
        uv sync

    - name: Install grafana alloy
      shell: bash
      run: |
        wget -q https://github.com/grafana/alloy/releases/download/${{ inputs.alloy-version }}/alloy-boringcrypto-linux-amd64.zip
        unzip alloy-boringcrypto-linux-amd64.zip
        sudo mv alloy-boringcrypto-linux-amd64 /usr/local/bin/alloy
