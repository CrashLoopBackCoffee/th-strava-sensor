# This repo uses uv for dependency management
uv sync --locked

export BASEDIR=$(git rev-parse --show-toplevel)

# Add helper scripts in deploy-base to PATH
export PATH="${BASEDIR}/scripts:${PATH}"

#  check if repo is enabled for pre-commit by checking if present in venv
if [ -f "./.venv/bin/pre-commit" ] && [ "${SKIP_PRE_COMMIT:-false}" != "true" ]; then

  #  link config if not present
  if [ ! -f ".pre-commit-config.yaml" ]; then
    echo -e "${GREEN}Linking .pre-commit-config.yaml$NC"
    ln -fs "${BASEDIR}/.pre-commit-config.yaml" .
  fi

  # Install pre-commit hook
  if [ ! -f ".git/hooks/pre-commit" ]; then
    echo -e "${GREEN}Installing pre-commit hook$NC"
    ./.venv/bin/pre-commit install
  fi

  # Install pre-push hook
  if [ ! -f ".git/hooks/pre-push" ]; then
    echo -e "${GREEN}Installing pre-push hook$NC"
    ./.venv/bin/pre-commit install --hook-type pre-push
  fi

  # Install hooks to save time on first commit
  echo "Ensuring pre-commit hooks are installed"
  ./.venv/bin/pre-commit install-hooks
else
  echo -e "${YELLOW}Pre-commit not enabled for this repo!$NC"
  echo -e "To enable pre-commit, run: ${PURPLE}poetry add --group dev pre-commit filelock distlib pyright ruff yamllint$NC"
fi
